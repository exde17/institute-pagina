---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Obtener todas las noticias y ordenarlas por fecha
const allNoticias = await getCollection('noticias');
const sortedNoticias = allNoticias.sort((a, b) => 
  new Date(b.data.fecha).getTime() - new Date(a.data.fecha).getTime()
);

// Funci√≥n para formatear fecha
function formatDate(dateString: string): string {
  const date = new Date(dateString);
  return date.toLocaleDateString('es-CO', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

// Destacar la primera noticia
const noticiaDestacada = sortedNoticias[0];
const otrasNoticias = sortedNoticias.slice(1);
---
<Layout title="Noticias ‚Äî Instituto Fundaci√≥n" description="Mantente informado sobre nuestras √∫ltimas novedades, eventos y logros.">
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-blue-900 via-slate-800 to-blue-800 text-white py-20 overflow-hidden">
    <div class="absolute inset-0 bg-[url('/hero.png')] opacity-10 bg-cover bg-center"></div>
    <div class="absolute top-0 left-0 w-96 h-96 bg-blue-500 rounded-full blur-3xl opacity-20 animate-pulse"></div>
    <div class="absolute bottom-0 right-0 w-72 h-72 bg-purple-500 rounded-full blur-3xl opacity-20 animate-pulse" style="animation-delay: 1s"></div>
    
    <div class="relative mx-auto max-w-6xl px-4 text-center">
      <div class="inline-block mb-4 px-4 py-2 bg-blue-500/20 backdrop-blur-sm border border-blue-400/30 rounded-full text-sm font-semibold">
        üì∞ Actualidad Institucional
      </div>
      <h1 class="text-4xl md:text-6xl font-extrabold mb-6 bg-gradient-to-r from-white via-blue-100 to-white bg-clip-text text-transparent">
        Noticias y Novedades
      </h1>
      <p class="text-lg md:text-xl text-blue-100 max-w-3xl mx-auto leading-relaxed">
        Mantente informado sobre nuestras √∫ltimas actividades, logros, eventos y todo lo que sucede 
        en el Instituto para la Formaci√≥n y el Desarrollo Comunitario.
      </p>
      
      <!-- Stats r√°pidas -->
      <div class="mt-8 flex flex-wrap justify-center gap-6">
        <div class="bg-white/10 backdrop-blur-md rounded-xl px-6 py-3 border border-white/20">
          <span class="text-2xl font-bold text-blue-300">{sortedNoticias.length}</span>
          <span class="text-sm text-blue-100 ml-2">Noticias</span>
        </div>
        <div class="bg-white/10 backdrop-blur-md rounded-xl px-6 py-3 border border-white/20">
          <span class="text-2xl font-bold text-green-300">Recientes</span>
          <span class="text-sm text-blue-100 ml-2">Actualizaciones</span>
        </div>
      </div>
    </div>
  </section>

  <section class="mx-auto max-w-7xl px-4 py-16">
    {sortedNoticias.length === 0 ? (
      <div class="text-center py-20">
        <div class="text-6xl mb-4">üì∞</div>
        <p class="text-slate-600 text-xl">No hay noticias disponibles en este momento.</p>
        <p class="text-slate-500 mt-2">Vuelve pronto para ver nuestras novedades.</p>
      </div>
    ) : (
      <>
        {/* Noticia Destacada Principal */}
        {noticiaDestacada && (
          <div class="mb-16">
            <div class="flex items-center gap-2 mb-6">
              <span class="text-2xl">‚≠ê</span>
              <h2 class="text-2xl font-bold text-slate-900">Noticia Destacada</h2>
            </div>
            
            <article class="group bg-white rounded-3xl overflow-hidden shadow-2xl border border-slate-200 hover:shadow-3xl transition-all duration-500">
              <div class="grid md:grid-cols-2 gap-0">
                {/* Imagen grande */}
                {noticiaDestacada.data.cover && (
                  <div class="aspect-[4/3] md:aspect-auto overflow-hidden bg-gradient-to-br from-blue-100 to-slate-100">
                    <img 
                      src={noticiaDestacada.data.cover} 
                      alt={noticiaDestacada.data.titulo}
                      class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                    />
                  </div>
                )}
                
                {/* Contenido */}
                <div class="p-8 md:p-12 flex flex-col justify-center">
                  <div class="flex items-center gap-3 mb-4">
                    <span class="px-4 py-1 bg-gradient-to-r from-blue-100 to-blue-50 text-blue-700 rounded-full text-sm font-bold border border-blue-200">
                      üî• M√°s reciente
                    </span>
                    <span class="text-sm text-slate-500 font-medium">
                      {formatDate(noticiaDestacada.data.fecha)}
                    </span>
                  </div>
                  
                  <h3 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 group-hover:text-blue-700 transition-colors">
                    {noticiaDestacada.data.titulo}
                  </h3>
                  
                  <p class="text-slate-600 text-lg leading-relaxed mb-6">
                    {noticiaDestacada.data.resumen}
                  </p>

                  <a 
                    href={`/noticias/${noticiaDestacada.slug}`}
                    class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300 w-fit"
                  >
                    Leer noticia completa
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                    </svg>
                  </a>
                </div>
              </div>
            </article>
          </div>
        )}

        {/* Grid de Otras Noticias */}
        {otrasNoticias.length > 0 && (
          <div>
            <h2 class="text-2xl font-bold text-slate-900 mb-8 flex items-center gap-2">
              <span>üìã</span>
              Todas las Noticias
            </h2>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {otrasNoticias.map((noticia, index) => (
                <article 
                  class="noticia-card group bg-white rounded-2xl overflow-hidden shadow-lg border border-slate-200 hover:shadow-2xl hover:-translate-y-2 transition-all duration-500"
                  style={`animation-delay: ${index * 0.1}s`}
                >
                  <a href={`/noticias/${noticia.slug}`} class="block">
                    {/* Imagen de portada */}
                    {noticia.data.cover ? (
                      <div class="aspect-video overflow-hidden bg-slate-100 relative">
                        <img 
                          src={noticia.data.cover} 
                          alt={noticia.data.titulo}
                          class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                        />
                        {/* Overlay transparente */}
                        <div class="absolute inset-0 bg-black/10 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                      </div>
                    ) : (
                      <div class="aspect-video bg-slate-200 flex items-center justify-center">
                        <span class="text-6xl">üì∞</span>
                      </div>
                    )}

                    {/* Badge de fecha */}
                    <div class="absolute top-4 right-4">
                      <span class="badge-date bg-white/95 backdrop-blur-sm text-slate-700 text-xs font-bold px-3 py-1.5 rounded-full shadow-lg border border-slate-200">
                        üìÖ {formatDate(noticia.data.fecha)}
                      </span>
                    </div>

                    {/* Badge destacado */}
                    {noticia.data.destacado && (
                      <div class="absolute top-4 left-4">
                        <span class="bg-amber-400 text-amber-900 text-xs font-bold px-3 py-1.5 rounded-full shadow-lg">
                          ‚≠ê Destacado
                        </span>
                      </div>
                    )}

                    {/* Contenido */}
                    <div class="p-6">
                      <h3 class="card-title text-xl font-bold text-slate-900 mb-3 line-clamp-2 group-hover:text-blue-700 transition-colors leading-tight">
                        {noticia.data.titulo}
                      </h3>
                      
                      <p class="text-slate-600 text-sm mb-4 line-clamp-3 leading-relaxed">
                        {noticia.data.resumen}
                      </p>

                      <div class="flex items-center justify-between mt-4 pt-4 border-t border-slate-100">
                        <span class="text-blue-600 font-bold text-sm read-more flex items-center gap-2 group-hover:gap-3 transition-all">
                          Leer m√°s
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                          </svg>
                        </span>
                        
                        {/* Indicador de lectura */}
                        <div class="flex gap-1">
                          <span class="w-2 h-2 rounded-full bg-blue-400 group-hover:bg-blue-600 transition-colors"></span>
                          <span class="w-2 h-2 rounded-full bg-blue-300 group-hover:bg-blue-500 transition-colors" style="transition-delay: 0.1s"></span>
                          <span class="w-2 h-2 rounded-full bg-blue-200 group-hover:bg-blue-400 transition-colors" style="transition-delay: 0.2s"></span>
                        </div>
                      </div>
                    </div>
                  </a>
                </article>
              ))}
            </div>
          </div>
        )}
      </>
    )}
  </section>

  <!-- CTA Section -->
  <section class="bg-gradient-to-r from-blue-600 via-blue-700 to-purple-600 text-white py-16 mt-16">
    <div class="mx-auto max-w-4xl px-4 text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">
        ¬øQuieres Recibir Nuestras Noticias?
      </h2>
      <p class="text-blue-100 text-lg mb-8 max-w-2xl mx-auto">
        Mantente al d√≠a con todas nuestras actividades, eventos y logros. 
        S√≠guenos en nuestras redes sociales o cont√°ctanos directamente.
      </p>
      <a 
        href="/contacto" 
        class="inline-block px-8 py-4 bg-white text-blue-700 font-bold rounded-full shadow-xl hover:bg-blue-50 hover:scale-105 transition-all duration-300"
      >
        Contactar Ahora ‚Üí
      </a>
    </div>
  </section>

  <style>
    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slide-up {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4);
      }
      50% {
        box-shadow: 0 0 20px 10px rgba(37, 99, 235, 0.1);
      }
    }

    .animate-fade-in {
      animation: fade-in 0.6s ease-out;
    }

    .animate-shake {
      animation: shake 0.5s ease-in-out;
    }

    .noticia-card {
      animation: slide-up 0.6s ease-out backwards;
      transition: all 0.3s ease;
    }

    .noticia-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .noticia-card:hover .card-title {
      color: rgb(30, 64, 175);
    }

    .noticia-card:hover .read-more {
      transform: translateX(5px);
    }

    .read-more {
      transition: transform 0.3s ease;
      display: inline-flex;
      align-items: center;
    }

    .badge-date {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      animation: pulse-glow 2s infinite;
    }
  </style>
</Layout>
