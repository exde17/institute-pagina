---
import Layout from '../../layouts/Layout.astro';
---
<Layout title="Noticias — Instituto Fundación">
  <section class="mx-auto max-w-6xl px-4 py-12">
    <header class="mb-12 animate-fade-in">
      <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-blue-800 to-blue-600 bg-clip-text text-transparent">
        Noticias
      </h1>
      <p class="mt-2 text-slate-600">Mantente informado sobre nuestras últimas novedades.</p>
    </header>

    <div id="loading" class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-800"></div>
      <p class="mt-4 text-slate-600">Cargando noticias...</p>
    </div>

    <div id="error" class="hidden bg-red-50 border border-red-200 rounded-lg p-6 mb-6 animate-shake">
      <p class="text-red-800"></p>
    </div>

    <div id="noticias-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </section>

  <style>
    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slide-up {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4);
      }
      50% {
        box-shadow: 0 0 20px 10px rgba(37, 99, 235, 0.1);
      }
    }

    .animate-fade-in {
      animation: fade-in 0.6s ease-out;
    }

    .animate-shake {
      animation: shake 0.5s ease-in-out;
    }

    .noticia-card {
      animation: slide-up 0.6s ease-out backwards;
      transition: all 0.3s ease;
    }

    .noticia-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .noticia-card:hover .card-title {
      color: rgb(30, 64, 175);
    }

    .noticia-card:hover .read-more {
      transform: translateX(5px);
    }

    .read-more {
      transition: transform 0.3s ease;
      display: inline-flex;
      align-items: center;
    }

    .badge-date {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      animation: pulse-glow 2s infinite;
    }
  </style>

  <script>
    import { getNoticias } from '../../lib/auth.ts';
    import type { Noticia } from '../../lib/auth.ts';

    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const containerEl = document.getElementById('noticias-container');

    // Función para formatear la fecha
    function formatDate(dateString: string): string {
      const date = new Date(dateString);
      return date.toLocaleDateString('es-CO', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    }

    // Función para truncar texto
    function truncateText(text: string, maxLength: number = 150): string {
      if (text.length <= maxLength) return text;
      return text.substring(0, maxLength) + '...';
    }

    // Cargar noticias
    async function loadNoticias() {
      try {
        const noticias = await getNoticias();
        
        if (loadingEl) loadingEl.classList.add('hidden');
        
        if (!noticias || noticias.length === 0) {
          if (containerEl) {
            containerEl.innerHTML = '<p class="text-slate-600 col-span-full text-center py-12">No hay noticias disponibles en este momento.</p>';
          }
          return;
        }

        // Ordenar por fecha (más reciente primero)
        const sortedNoticias = noticias.sort((a, b) => 
          new Date(b.fecha).getTime() - new Date(a.fecha).getTime()
        );

        // Renderizar noticias
        if (containerEl) {
          containerEl.innerHTML = sortedNoticias.map((noticia: Noticia, index: number) => `
            <article 
              class="noticia-card rounded-2xl border overflow-hidden bg-white cursor-pointer relative group"
              style="animation-delay: ${index * 0.1}s"
              onclick="verDetalle('${noticia.id}')"
            >
              <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-600 via-purple-500 to-pink-500"></div>
              
              <div class="p-6">
                <div class="badge-date inline-block text-white text-xs px-3 py-1 rounded-full mb-3">
                  ${formatDate(noticia.fecha)}
                </div>
                
                <h3 class="card-title text-xl font-bold mb-3 capitalize transition-colors duration-300">
                  ${noticia.titulo}
                </h3>
                
                <p class="text-slate-600 text-sm mb-4 leading-relaxed">
                  ${truncateText(noticia.contenido)}
                </p>
                
                <div class="flex items-center justify-between">
                  <span class="read-more text-blue-800 hover:text-blue-600 text-sm font-semibold">
                    Leer más 
                    <svg class="inline-block w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                  </span>
                  
                  <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                    <span class="w-2 h-2 rounded-full bg-purple-500 animate-pulse" style="animation-delay: 0.2s"></span>
                    <span class="w-2 h-2 rounded-full bg-pink-500 animate-pulse" style="animation-delay: 0.4s"></span>
                  </div>
                </div>
              </div>
              
              <div class="absolute bottom-0 right-0 w-24 h-24 bg-gradient-to-tl from-blue-50 to-transparent rounded-tl-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            </article>
          `).join('');
        }

      } catch (err: any) {
        if (loadingEl) loadingEl.classList.add('hidden');
        if (errorEl) {
          errorEl.classList.remove('hidden');
          const errorText = errorEl.querySelector('p');
          if (errorText) {
            errorText.textContent = err.message || 'Error al cargar las noticias. Por favor, intenta más tarde.';
          }
        }
      }
    }

    // Función para ver detalle (puedes expandir esto más adelante)
    (window as any).verDetalle = (noticiaId: string) => {
      // Por ahora solo muestra un alert, pero puedes implementar un modal o redirigir
      alert(`Funcionalidad de detalle próximamente. Noticia ID: ${noticiaId}`);
    };

    // Cargar noticias al cargar la página
    loadNoticias();
  </script>
</Layout>
