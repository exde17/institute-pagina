---
import Layout from '../layouts/Layout.astro';

// Datos de fallback para cuando no se pueda cargar desde la API
// Los datos reales se cargar√°n desde la API en el cliente
const programasDataFallback = [
  {
    id: 'fotovoltaicos',
    nombre: 'Instalaci√≥n de Paneles Solares',
    imagen: '/img/flyers/FOTOVOLTAICOS.png',
    descripcion: 'Convi√©rtete en un experto en energ√≠as renovables. Aprende a dise√±ar, instalar y mantener sistemas fotovoltaicos residenciales y comerciales.',
    duracion: '3 semestres',
    modalidad: 'Presencial',
    categoria: 'T√©cnico',
    badge: 'Popular',
    badgeColor: 'green',
      semestres: [
        {
          numero: 'I',
          nombre: 'Instalaciones Fotovoltaicas y Electricidad',
          materias: [
            'Instalaci√≥n de acometidas el√©ctricas de acuerdo con reglamento t√©cnico',
            'Operaciones b√°sicas en el montaje y mantenimiento de instalaciones solares fotovoltaicas',
            'Lengua extranjera - Ingl√©s'
          ]
        },
        {
          numero: 'II',
          nombre: 'Sistemas Solares T√©rmicos y Mec√°nica',
          materias: [
            'Operaciones b√°sicas en el montaje y mantenimiento de instalaciones solares t√©rmicas',
            'Mecanizado b√°sico',
            'Desarrollo humano - Prepr√°ctica'
          ]
        },
        {
          numero: 'III',
          nombre: 'Pr√°ctica Empresarial',
          materias: [
            'Pr√°ctica Empresarial'
          ]
        }
      ],
      detalles: [
        'Fundamentos de energ√≠a solar',
        'Dise√±o de sistemas fotovoltaicos',
        'Instalaci√≥n y mantenimiento',
        'Normatividad y certificaciones',
        'Pr√°cticas en proyectos reales'
      ]
  },
  {
    id: 'marketing',
    nombre: 'Marketing y Redes Sociales',
    imagen: '/img/flyers/MARKETING Y REDES SOCIALES.png',
    descripcion: 'Domina las estrategias digitales m√°s efectivas. Crea contenido que impacta y gestiona comunidades en l√≠nea para impulsar marcas en el mundo digital.',
    duracion: '3 semestres',
    modalidad: 'Presencial',
    categoria: 'Marketing Digital',
    badge: 'Trending',
    badgeColor: 'purple',
    semestres: [
      {
        numero: 'I',
        nombre: 'Fundamentos y Comunicaci√≥n',
        materias: [
          'Audiovisuales',
          'Comunicaci√≥n I',
          'Comunicaci√≥n II',
          'Creaci√≥n de Contenido',
          'Ingl√©s B√°sico',
          'Inducci√≥n',
          'TICs'
        ]
      },
      {
        numero: 'II',
        nombre: 'Marketing Digital',
        materias: [
          'Investigaci√≥n de Mercado',
          'Estrategia de Mercadeo',
          'Marketing Digital I',
          'Marketing Digital II',
          'Desarrollo Humano',
          'Gesti√≥n Empresarial I'
        ]
      },
      {
        numero: 'III',
        nombre: 'Pr√°ctica Profesional',
        materias: [
          'Pr√°ctica Empresarial'
        ]
      }
    ],
    detalles: [
      'Community Management profesional',
      'Estrategias de contenido viral',
      'Publicidad en redes sociales',
      'Anal√≠tica y m√©tricas digitales',
      'Gesti√≥n de crisis online'
    ]
  },
  {
    id: 'innovacion',
    nombre: 'Gesti√≥n de la Innovaci√≥n',
    imagen: '/img/flyers/GESTI√ìN DE LA INNOVACI√ìN.png',
    descripcion: 'Lidera proyectos innovadores y transforma ideas en realidad. Desarrolla habilidades de emprendimiento y gesti√≥n de proyectos disruptivos.',
    duracion: '3 semestres',
    modalidad: 'Presencial',
    categoria: 'Emprendimiento',
    badge: 'Nuevo',
    badgeColor: 'blue',
      semestres: [
        {
          numero: 'I',
          nombre: 'Innovaci√≥n y Procesos Empresariales',
          materias: [
            'Innovaci√≥n empresarial seg√∫n criterios estrat√©gicos',
            'Protocolo y especificaciones de proceso de negocio',
            'Prestaci√≥n de servicio seg√∫n modelo de gesti√≥n y proceso de negocio',
            'Lengua extranjera - Ingl√©s'
          ]
        },
        {
          numero: 'II',
          nombre: 'Gesti√≥n y Herramientas Digitales',
          materias: [
            'Requerimiento del servicio de acuerdo con marcos de preferencia y modelo de negocios',
            'Tratamiento de documentos de acuerdo con procesos t√©cnico y normativa',
            'Herramientas inform√°ticas y digitales',
            'Desarrollo humano - Prepr√°ctica'
          ]
        },
        {
          numero: 'III',
          nombre: 'Pr√°ctica Empresarial',
          materias: [
            'Pr√°ctica Empresarial'
          ]
        }
      ],
      detalles: [
        'Metodolog√≠as √°giles y Design Thinking',
        'Gesti√≥n de proyectos innovadores',
        'Creatividad y pensamiento lateral',
        'Pitch y presentaci√≥n de proyectos',
        'Financiamiento y escalamiento'
      ]
  },
  
  {
    id: 'culturales',
    nombre: 'Programas Culturales y Art√≠sticos',
    imagen: '/img/flyers/CULTURALES Y ARTISTICOS.png',
    descripcion: 'Descubre y potencia tu talento art√≠stico. Participa en talleres de m√∫sica, danza, teatro y artes pl√°sticas con instructores profesionales.',
    duracion: '3 semestres',
    modalidad: 'Presencial',
    categoria: 'Arte y Cultura',
    badge: 'Creativo',
    badgeColor: 'pink',
    semestres: [
      {
        numero: 'I',
        nombre: 'Gesti√≥n y Patrimonio Cultural',
        materias: [
          'Gesti√≥n cultural y art√≠stica',
          'Gesti√≥n documental',
          'Herramientas Inform√°ticas para la Documentaci√≥n y Gesti√≥n',
          'Patrimonio Cultural y Art√≠stico',
          'Lengua extranjera Ingl√©s ‚Äì Introductory'
        ]
      },
      {
        numero: 'II',
        nombre: 'Proyectos y Emprendimiento',
        materias: [
          'Fundamentos de Proyectos',
          'Habilidades de Emprendimiento e Innovaci√≥n I',
          'Investigaci√≥n y Diagn√≥stico Cultural',
          'Gesti√≥n Cultural y Art√≠stica II',
          'Administraci√≥n del Patrimonio Cultural y Art√≠stico'
        ]
      },
      {
        numero: 'III',
        nombre: 'Eventos y Pr√°ctica Laboral',
        materias: [
          'Organizaci√≥n de Festivales y Eventos',
          'Formulaci√≥n y Gesti√≥n de Proyectos culturales y art√≠sticos',
          'Marketing Cultural y art√≠stico',
          'Emprendimiento e innovaci√≥n II',
          'Pr√°ctica laboral'
        ]
      }
    ],
    detalles: [
      'Gesti√≥n cultural y art√≠stica profesional',
      'Organizaci√≥n de festivales y eventos',
      'Emprendimiento e innovaci√≥n en el arte',
      'Administraci√≥n de patrimonio cultural',
      'Pr√°cticas en proyectos reales'
    ]
  },
  {
    id: 'deportes',
    nombre: 'Deportes y Recreaci√≥n',
    imagen: '/img/flyers/DEPORTES Y RECREACI√ìN.png',
    descripcion: 'Promueve h√°bitos de vida saludable a trav√©s del deporte. Participa en programas de f√∫tbol, voleibol, atletismo y actividades recreativas.',
    duracion: '3 semestres',
    modalidad: 'Presencial',
    categoria: 'Deporte y Salud',
    badge: 'Activo',
    badgeColor: 'orange',
    semestres: [
      {
        numero: 'I',
        nombre: 'Fundamentos y Escenarios Deportivos',
        materias: [
          'Primer Respondiente',
          'Escenarios deportivos',
          'Programaci√≥n de Ejercicios',
          'Fundamentaci√≥n T√©cnico T√°ctica del Deportista',
          'Eventos Deportivos'
        ]
      },
      {
        numero: 'II',
        nombre: 'Educaci√≥n F√≠sica y Salud',
        materias: [
          'Sesiones Grupales de Educaci√≥n F√≠sica',
          'Sesiones de Actividad F√≠sica',
          'Seguridad y salud en el trabajo',
          'Pr√°cticas saludables'
        ]
      },
      {
        numero: 'III',
        nombre: 'Pr√°ctica Profesional',
        materias: [
          'Pr√°ctica profesional en escenarios deportivos',
          'Organizaci√≥n de eventos deportivos',
          'Acompa√±amiento y gesti√≥n de actividades f√≠sicas',
          'Evaluaci√≥n y cierre de ciclo formativo'
        ]
      }
    ],
    detalles: [
      'Entrenamiento deportivo b√°sico',
      'Disciplinas: f√∫tbol, voleibol, atletismo',
      'Actividades recreativas grupales',
      'Nutrici√≥n deportiva b√°sica',
      'Torneos y competencias',
      'Pr√°cticas profesionales en escenarios reales'
    ]
  }
];
---
<Layout title="Programas ‚Äî FCM INSTITUTE">
  <section class="mx-auto max-w-7xl px-4 py-12">
    <header class="mb-12 text-center animate-fade-in">
      <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-800 via-purple-700 to-blue-600 bg-clip-text text-transparent mb-4">
        Nuestros Programas de Formaci√≥n
      </h1>
      <div class="w-24 h-1 bg-gradient-to-r from-blue-600 to-purple-600 mx-auto rounded-full mb-6"></div>
      <p class="text-lg text-slate-600 max-w-3xl mx-auto">
        Explora nuestra oferta completa de programas dise√±ados para transformar tu futuro profesional y personal.
      </p>
      <div class="mt-6 flex flex-wrap justify-center gap-3">
        <span id="programas-count" class="px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">üìö 6 Programas</span>
        <span class="px-4 py-2 bg-purple-100 text-purple-800 rounded-full text-sm font-semibold">üë• +500 Estudiantes</span>
        <span class="px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-semibold">‚úì Certificados</span>
      </div>
    </header>

    <div id="programas-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {programasDataFallback.map((programa, index) => (
        <article 
          class="programa-card bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-500 group"
          style={`animation-delay: ${index * 0.1}s`}
        >
          <!-- Imagen del programa -->
          <div class="relative h-64 overflow-hidden">
            <img 
              src={programa.imagen} 
              alt={programa.nombre}
              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/50 to-transparent opacity-70"></div>
            
            <!-- Badge -->
            <div class={`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-bold text-white ${
              programa.badgeColor === 'green' ? 'bg-green-500' :
              programa.badgeColor === 'purple' ? 'bg-purple-500' :
              programa.badgeColor === 'blue' ? 'bg-blue-500' :
              programa.badgeColor === 'emerald' ? 'bg-emerald-500' :
              programa.badgeColor === 'pink' ? 'bg-pink-500' :
              'bg-orange-500'
            }`}>
              {programa.badge}
            </div>

            <!-- T√≠tulo sobre la imagen -->
            <div class="absolute bottom-0 left-0 right-0 p-4 text-white z-10">
              <h2 class="text-2xl font-bold mb-1 group-hover:text-yellow-400 transition-colors">
                {programa.nombre}
              </h2>
              <span class="inline-block px-2 py-1 bg-white/20 backdrop-blur-sm rounded text-xs font-semibold">
                {programa.categoria}
              </span>
            </div>
          </div>

          <!-- Contenido -->
          <div class="p-6">
            <p class="text-slate-600 text-sm leading-relaxed mb-4">
              {programa.descripcion}
            </p>

            <!-- Detalles del programa -->
            <div class="mb-4 space-y-2">
              <h3 class="text-sm font-bold text-slate-700 mb-2">üìã Contenido del programa:</h3>
              
              {/* Si el programa tiene semestres, mostrar estructura semestral */}
              {programa.semestres ? (
                <div class="space-y-3">
                  <div class="semestres-preview">
                    {programa.semestres.map((semestre, idx) => (
                      <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                        <div class="flex items-center gap-2 mb-2">
                          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 text-white flex items-center justify-center text-xs font-bold">
                            {semestre.numero}
                          </div>
                          <div>
                            <div class="text-xs font-bold text-slate-800">{semestre.nombre}</div>
                            <div class="text-xs text-slate-500">{semestre.materias.length} m√≥dulos</div>
                          </div>
                        </div>
                        <ul class="space-y-1 ml-10">
                          {semestre.materias.slice(0, idx === 0 ? 2 : 0).map((materia) => (
                            <li class="text-xs text-slate-600 flex items-start gap-2">
                              <svg class="w-3 h-3 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                              </svg>
                              {materia}
                            </li>
                          ))}
                        </ul>
                      </div>
                    ))}
                  </div>
                  
                  <div class="semestres-full hidden">
                    {programa.semestres.map((semestre, idx) => (
                      <div class="bg-gradient-to-br from-slate-50 to-blue-50 rounded-lg p-4 border-2 border-blue-200 mb-3">
                        <div class="flex items-center gap-3 mb-3">
                          <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 text-white flex items-center justify-center text-sm font-bold shadow-lg">
                            {semestre.numero}
                          </div>
                          <div>
                            <div class="text-sm font-bold text-slate-900">{semestre.nombre}</div>
                            <div class="text-xs text-slate-600">{semestre.materias.length} m√≥dulos</div>
                          </div>
                        </div>
                        <ul class="space-y-2 ml-13">
                          {semestre.materias.map((materia) => (
                            <li class="text-xs text-slate-700 flex items-start gap-2 bg-white px-3 py-2 rounded-md shadow-sm">
                              <svg class="w-4 h-4 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                              </svg>
                              <span class="font-medium">{materia}</span>
                            </li>
                          ))}
                        </ul>
                      </div>
                    ))}
                  </div>
                </div>
              ) : (
                /* Si no tiene semestres, mostrar lista de detalles tradicional */
                <ul class="space-y-1">
                  {programa.detalles.slice(0, 3).map(detalle => (
                    <li class="text-xs text-slate-600 flex items-start gap-2">
                      <svg class="w-4 h-4 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                      </svg>
                      {detalle}
                    </li>
                  ))}
                </ul>
              )}
              
              <button 
                class="show-more-btn text-xs text-blue-600 hover:text-blue-800 font-semibold mt-2 flex items-center gap-1"
                data-programa-id={programa.id}
              >
                Ver m√°s detalles
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>
            </div>

            <!-- Info adicional -->
            <div class="flex gap-2 mb-4">
              <div class="flex-1 bg-gradient-to-br from-purple-500 to-pink-500 text-white text-center py-2 px-3 rounded-lg">
                <div class="text-xs opacity-90">Duraci√≥n</div>
                <div class="text-sm font-bold">{programa.duracion}</div>
              </div>
              <div class="flex-1 bg-gradient-to-br from-blue-500 to-cyan-500 text-white text-center py-2 px-3 rounded-lg">
                <div class="text-xs opacity-90">Modalidad</div>
                <div class="text-sm font-bold">{programa.modalidad}</div>
              </div>
            </div>

            <!-- Bot√≥n de acci√≥n -->
            <button 
              class="btn-inscribir w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl px-4 py-3 font-bold transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl"
              data-programa-id={programa.id}
              data-programa-nombre={programa.nombre}
            >
              <span class="flex items-center justify-center gap-2">
                Inscribirme ahora
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                </svg>
              </span>
            </button>
          </div>
        </article>
      ))}
    </div>

    <!-- CTA Final -->
    <div class="mt-16 text-center bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-8 text-white">
      <h2 class="text-3xl font-bold mb-4">¬øListo para transformar tu futuro?</h2>
      <p class="text-lg mb-6 opacity-90">
        √önete a nuestra comunidad de m√°s de 500 estudiantes que ya est√°n construyendo su camino al √©xito.
      </p>
      <a 
        href="/contacto" 
        class="inline-flex items-center gap-2 bg-white text-blue-600 px-8 py-4 rounded-xl font-bold hover:bg-slate-100 transform hover:scale-105 transition-all duration-300 shadow-xl"
      >
        Cont√°ctanos ahora
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        </svg>
      </a>
    </div>

    <!-- Modal de √âxito -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl p-8 max-w-md w-full transform scale-95 opacity-0 transition-all duration-300" id="success-modal-content">
        <div class="text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-slate-900 mb-2" id="success-title">¬°Inscripci√≥n Exitosa!</h3>
          <p class="text-slate-600 mb-6" id="success-message">Pronto nos pondremos en contacto contigo.</p>
          <button id="success-close" class="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white px-6 py-3 rounded-xl font-bold transform hover:scale-105 transition-all duration-300">
            ¬°Perfecto!
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de Error -->
    <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl p-8 max-w-md w-full transform scale-95 opacity-0 transition-all duration-300" id="error-modal-content">
        <div class="text-center">
          <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-slate-900 mb-2" id="error-title">Error</h3>
          <p class="text-slate-600 mb-6" id="error-message">Ha ocurrido un error inesperado.</p>
          <button id="error-close" class="w-full bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white px-6 py-3 rounded-xl font-bold transform hover:scale-105 transition-all duration-300">
            Entendido
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl p-8 max-w-md w-full transform scale-95 opacity-0 transition-all duration-300" id="confirm-modal-content">
        <div class="text-center">
          <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-slate-900 mb-2" id="confirm-title">Confirmar Inscripci√≥n</h3>
          <p class="text-slate-600 mb-6" id="confirm-message">¬øConfirmas tu inscripci√≥n?</p>
          <div class="flex gap-3">
            <button id="confirm-cancel" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 px-6 py-3 rounded-xl font-bold transform hover:scale-105 transition-all duration-300">
              Cancelar
            </button>
            <button id="confirm-accept" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white px-6 py-3 rounded-xl font-bold transform hover:scale-105 transition-all duration-300">
              Confirmar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Prompt -->
    <div id="prompt-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl p-8 max-w-md w-full transform scale-95 opacity-0 transition-all duration-300" id="prompt-modal-content">
        <div class="text-center">
          <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-slate-900 mb-2" id="prompt-title">Observaciones</h3>
          <p class="text-slate-600 mb-4" id="prompt-message">¬øTienes alguna observaci√≥n o comentario?</p>
          <textarea id="prompt-input" class="w-full p-3 border border-slate-300 rounded-lg mb-4 resize-none" rows="3" placeholder="Escribe tus observaciones aqu√≠..."></textarea>
          <div class="flex gap-3">
            <button id="prompt-cancel" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 px-6 py-3 rounded-xl font-bold transform hover:scale-105 transition-all duration-300">
              Omitir
            </button>
            <button id="prompt-accept" class="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-3 rounded-xl font-bold transform hover:scale-105 transition-all duration-300">
              Continuar
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <style>
    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slide-up {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in {
      animation: fade-in 0.6s ease-out;
    }

    .programa-card {
      animation: slide-up 0.6s ease-out backwards;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .programa-card:hover {
      transform: translateY(-12px);
    }

    .btn-inscribir {
      position: relative;
      overflow: hidden;
    }

    .btn-inscribir::after {
      content: '';
      position: absolute;
      inset-block-start: 50%;
      inset-inline-start: 50%;
      inline-size: 0;
      block-size: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-inscribir:hover::after {
      inline-size: 300px;
      block-size: 300px;
    }

    .details-expanded {
      max-height: 500px;
      transition: max-height 0.5s ease-in-out;
    }
  </style>

  <script>
    // Importar la funci√≥n de la API
    import { getProgramas } from '../lib/auth.ts';

    // Variable global para almacenar los programas cargados
    let programasCargados = [];

    // Funci√≥n para mostrar modal de √©xito
    function showSuccessModal(title, message) {
      const modal = document.getElementById('success-modal');
      const modalContent = document.getElementById('success-modal-content');
      const titleEl = document.getElementById('success-title');
      const messageEl = document.getElementById('success-message');
      const closeBtn = document.getElementById('success-close');

      if (titleEl) titleEl.textContent = title;
      if (messageEl) messageEl.textContent = message;

      modal.classList.remove('hidden');
      setTimeout(() => {
        modalContent.classList.remove('scale-95', 'opacity-0');
        modalContent.classList.add('scale-100', 'opacity-100');
      }, 10);

      const closeModal = () => {
        modalContent.classList.remove('scale-100', 'opacity-100');
        modalContent.classList.add('scale-95', 'opacity-0');
        setTimeout(() => {
          modal.classList.add('hidden');
        }, 300);
      };

      closeBtn.addEventListener('click', closeModal, { once: true });
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
    }

    // Funci√≥n para mostrar modal de error
    function showErrorModal(title, message) {
      const modal = document.getElementById('error-modal');
      const modalContent = document.getElementById('error-modal-content');
      const titleEl = document.getElementById('error-title');
      const messageEl = document.getElementById('error-message');
      const closeBtn = document.getElementById('error-close');

      if (titleEl) titleEl.textContent = title;
      if (messageEl) messageEl.textContent = message;

      modal.classList.remove('hidden');
      setTimeout(() => {
        modalContent.classList.remove('scale-95', 'opacity-0');
        modalContent.classList.add('scale-100', 'opacity-100');
      }, 10);

      const closeModal = () => {
        modalContent.classList.remove('scale-100', 'opacity-100');
        modalContent.classList.add('scale-95', 'opacity-0');
        setTimeout(() => {
          modal.classList.add('hidden');
        }, 300);
      };

      closeBtn.addEventListener('click', closeModal, { once: true });
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
    }

    // Funci√≥n para mostrar modal de confirmaci√≥n
    function showConfirmModal(title, message) {
      return new Promise((resolve) => {
        const modal = document.getElementById('confirm-modal');
        const modalContent = document.getElementById('confirm-modal-content');
        const titleEl = document.getElementById('confirm-title');
        const messageEl = document.getElementById('confirm-message');
        const cancelBtn = document.getElementById('confirm-cancel');
        const acceptBtn = document.getElementById('confirm-accept');

        if (titleEl) titleEl.textContent = title;
        if (messageEl) messageEl.textContent = message;

        modal.classList.remove('hidden');
        setTimeout(() => {
          modalContent.classList.remove('scale-95', 'opacity-0');
          modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);

        const closeModal = (result) => {
          modalContent.classList.remove('scale-100', 'opacity-100');
          modalContent.classList.add('scale-95', 'opacity-0');
          setTimeout(() => {
            modal.classList.add('hidden');
            resolve(result);
          }, 300);
        };

        cancelBtn.addEventListener('click', () => closeModal(false), { once: true });
        acceptBtn.addEventListener('click', () => closeModal(true), { once: true });
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closeModal(false);
        });
      });
    }

    // Funci√≥n para mostrar modal de prompt
    function showPromptModal(title, message, defaultValue = '') {
      return new Promise((resolve) => {
        const modal = document.getElementById('prompt-modal');
        const modalContent = document.getElementById('prompt-modal-content');
        const titleEl = document.getElementById('prompt-title');
        const messageEl = document.getElementById('prompt-message');
        const inputEl = document.getElementById('prompt-input');
        const cancelBtn = document.getElementById('prompt-cancel');
        const acceptBtn = document.getElementById('prompt-accept');

        if (titleEl) titleEl.textContent = title;
        if (messageEl) messageEl.textContent = message;
        if (inputEl) inputEl.value = defaultValue;

        modal.classList.remove('hidden');
        setTimeout(() => {
          modalContent.classList.remove('scale-95', 'opacity-0');
          modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);

        const closeModal = (result) => {
          modalContent.classList.remove('scale-100', 'opacity-100');
          modalContent.classList.add('scale-95', 'opacity-0');
          setTimeout(() => {
            modal.classList.add('hidden');
            resolve(result);
          }, 300);
        };

        cancelBtn.addEventListener('click', () => closeModal(null), { once: true });
        acceptBtn.addEventListener('click', () => {
          const value = inputEl ? inputEl.value : '';
          closeModal(value);
        }, { once: true });
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closeModal(null);
        });

        // Focus en el input
        setTimeout(() => {
          if (inputEl) inputEl.focus();
        }, 100);
      });
    }

    // Funci√≥n para renderizar los programas
    function renderProgramas(programas) {
      // Guardar los programas para usarlos en la inscripci√≥n
      programasCargados = programas;
      
      const grid = document.getElementById('programas-grid');
      const countSpan = document.getElementById('programas-count');
      
      if (!grid) return;
      
      // Actualizar contador
      if (countSpan) {
        countSpan.textContent = `üìö ${programas.length} Programas`;
      }
      
      // Limpiar grid
      grid.innerHTML = '';
      
      // Renderizar cada programa
      programas.forEach((programa, index) => {
        const duracionTexto = typeof programa.duracion === 'number' 
          ? `${programa.duracion} semestres` 
          : programa.duracion;
        
        const article = document.createElement('article');
        article.className = 'programa-card bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-500 group';
        article.style.animationDelay = `${index * 0.1}s`;
        
        // Determinar el color del badge
        const badgeColorClass = 
          programa.badgeColor === 'green' ? 'bg-green-500' :
          programa.badgeColor === 'purple' ? 'bg-purple-500' :
          programa.badgeColor === 'blue' ? 'bg-blue-500' :
          programa.badgeColor === 'emerald' ? 'bg-emerald-500' :
          programa.badgeColor === 'pink' ? 'bg-pink-500' :
          'bg-orange-500';
        
        // Renderizar semestres o detalles
        let contenidoPrograma = '';
        if (programa.semestres && programa.semestres.length > 0) {
          // Mostrar estructura de semestres
          contenidoPrograma = `
            <div class="space-y-3">
              <div class="semestres-preview">
                ${programa.semestres.map((semestre, idx) => `
                  <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                    <div class="flex items-center gap-2 mb-2">
                      <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 text-white flex items-center justify-center text-xs font-bold">
                        ${semestre.numero}
                      </div>
                      <div>
                        <div class="text-xs font-bold text-slate-800">${semestre.nombre}</div>
                        <div class="text-xs text-slate-500">${semestre.materias.length} m√≥dulos</div>
                      </div>
                    </div>
                    <ul class="space-y-1 ml-10">
                      ${semestre.materias.slice(0, idx === 0 ? 2 : 0).map(materia => `
                        <li class="text-xs text-slate-600 flex items-start gap-2">
                          <svg class="w-3 h-3 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                          </svg>
                          ${materia}
                        </li>
                      `).join('')}
                    </ul>
                  </div>
                `).join('')}
              </div>
              
              <div class="semestres-full hidden">
                ${programa.semestres.map(semestre => `
                  <div class="bg-gradient-to-br from-slate-50 to-blue-50 rounded-lg p-4 border-2 border-blue-200 mb-3">
                    <div class="flex items-center gap-3 mb-3">
                      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 text-white flex items-center justify-center text-sm font-bold shadow-lg">
                        ${semestre.numero}
                      </div>
                      <div>
                        <div class="text-sm font-bold text-slate-900">${semestre.nombre}</div>
                        <div class="text-xs text-slate-600">${semestre.materias.length} m√≥dulos</div>
                      </div>
                    </div>
                    <ul class="space-y-2 ml-13">
                      ${semestre.materias.map(materia => `
                        <li class="text-xs text-slate-700 flex items-start gap-2 bg-white px-3 py-2 rounded-md shadow-sm">
                          <svg class="w-4 h-4 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                          </svg>
                          <span class="font-medium">${materia}</span>
                        </li>
                      `).join('')}
                    </ul>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        } else if (programa.detalles && programa.detalles.length > 0) {
          // Mostrar lista de detalles tradicional
          contenidoPrograma = `
            <ul class="space-y-1">
              ${programa.detalles.slice(0, 3).map(detalle => `
                <li class="text-xs text-slate-600 flex items-start gap-2">
                  <svg class="w-4 h-4 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                  ${detalle}
                </li>
              `).join('')}
            </ul>
          `;
        }
        
        article.innerHTML = `
          <!-- Imagen del programa -->
          <div class="relative h-64 overflow-hidden">
            <img
              src="${programa.imagen}"
              alt="${programa.nombre}"
              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/50 to-transparent opacity-70"></div>

            <!-- Badge -->
            <div class="absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-bold text-white ${badgeColorClass}">
              ${programa.badge}
            </div>

            <!-- T√≠tulo sobre la imagen -->
            <div class="absolute bottom-0 left-0 right-0 p-4 text-white z-10">
              <h2 class="text-2xl font-bold mb-1 group-hover:text-yellow-400 transition-colors">
                ${programa.nombre}
              </h2>
              <span class="inline-block px-2 py-1 bg-white/20 backdrop-blur-sm rounded text-xs font-semibold">
                ${programa.categoria}
              </span>
            </div>
          </div>

          <!-- Contenido -->
          <div class="p-6">
            <p class="text-slate-600 text-sm leading-relaxed mb-4">
              ${programa.descripcion}
            </p>

            <!-- Detalles del programa -->
            <div class="mb-4 space-y-2">
              <h3 class="text-sm font-bold text-slate-700 mb-2">üìã Contenido del programa:</h3>
              ${contenidoPrograma}
              <button
                class="show-more-btn text-xs text-blue-600 hover:text-blue-800 font-semibold mt-2 flex items-center gap-1"
                data-programa-id="${programa.id}"
              >
                Ver m√°s detalles
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>
            </div>

            <!-- Info adicional -->
            <div class="flex gap-2 mb-4">
              <div class="flex-1 bg-gradient-to-br from-purple-500 to-pink-500 text-white text-center py-2 px-3 rounded-lg">
                <div class="text-xs opacity-90">Duraci√≥n</div>
                <div class="text-sm font-bold">${duracionTexto}</div>
              </div>
              <div class="flex-1 bg-gradient-to-br from-blue-500 to-cyan-500 text-white text-center py-2 px-3 rounded-lg">
                <div class="text-xs opacity-90">Modalidad</div>
                <div class="text-sm font-bold">${programa.modalidad}</div>
              </div>
            </div>

            <!-- Bot√≥n de acci√≥n -->
            <button
              class="btn-inscribir w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl px-4 py-3 font-bold transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl"
              data-programa-id="${programa.id}"
              data-programa-nombre="${programa.nombre}"
            >
              <span class="flex items-center justify-center gap-2">
                Inscribirme ahora
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                </svg>
              </span>
            </button>
          </div>
        `;
        
        grid.appendChild(article);
      });
      
      // Re-attach event listeners
      attachEventListeners();
    }

    // Funci√≥n para agregar los event listeners
    function attachEventListeners() {
      // Funci√≥n para manejar "Ver m√°s detalles"
      const showMoreButtons = document.querySelectorAll('.show-more-btn');
      
      showMoreButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const card = (e.currentTarget as HTMLElement).closest('.programa-card');
          
          // Buscar si tiene semestres o detalles tradicionales
          const semestresPreview = card?.querySelector('.semestres-preview');
          const semestresFull = card?.querySelector('.semestres-full');
          const detallesList = card?.querySelector('ul');
          
          if (semestresPreview && semestresFull) {
            // Programa con semestres (como Marketing)
            const isExpanded = !semestresFull.classList.contains('hidden');
            
            if (!isExpanded) {
              // Mostrar todos los semestres
              semestresPreview.classList.add('hidden');
              semestresFull.classList.remove('hidden');
              (e.currentTarget as HTMLElement).innerHTML = `
                Ver menos detalles
                <svg class="w-3 h-3 transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              `;
            } else {
              // Ocultar detalles completos
              semestresPreview.classList.remove('hidden');
              semestresFull.classList.add('hidden');
              (e.currentTarget as HTMLElement).innerHTML = `
                Ver m√°s detalles
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              `;
            }
          } else if (detallesList) {
            // Programa con lista tradicional de detalles
            const isExpanded = detallesList.classList.contains('details-expanded');
            
            if (!isExpanded) {
              // Mostrar todos los detalles
              detallesList.classList.add('details-expanded');
              (e.currentTarget as HTMLElement).innerHTML = `
                Ver menos detalles
                <svg class="w-3 h-3 transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              `;
            } else {
              // Ocultar detalles extras
              detallesList.classList.remove('details-expanded');
              (e.currentTarget as HTMLElement).innerHTML = `
                Ver m√°s detalles
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              `;
            }
          }
        });
      });

      // Funci√≥n para manejar inscripci√≥n
      const inscribirButtons = document.querySelectorAll('.btn-inscribir');
      
      inscribirButtons.forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const button = e.currentTarget as HTMLButtonElement;
          const programaId = button.dataset.programaId;
          const programaNombre = button.dataset.programaNombre;
          
          console.log('=== INICIO DE INSCRIPCI√ìN ===');
          console.log('Programa ID:', programaId);
          console.log('Programa Nombre:', programaNombre);
          
          // Verificar si hay token (usuario logueado)
          const token = localStorage.getItem('auth_token');
          
          if (!token) {
            console.log('No hay token, redirigiendo al login');
            const shouldLogin = await showConfirmModal(
              'Inicio de Sesi√≥n Requerido',
              `Para inscribirte en "${programaNombre}" debes iniciar sesi√≥n. ¬øDeseas ir al login?`
            );
            if (shouldLogin) {
              window.location.href = '/auth/login';
            }
            return;
          }

          // Verificar que tenemos el ID del programa
          if (!programaId) {
            console.error('Error: No se pudo obtener el ID del programa');
            await showErrorModal(
              'Error',
              'No se pudo obtener la informaci√≥n del programa. Por favor, recarga la p√°gina e intenta nuevamente.'
            );
            return;
          }

          // Pedir observaci√≥n al usuario
          const observacion = await showPromptModal(
            'Observaciones',
            `¬øTienes alguna observaci√≥n o comentario sobre tu inscripci√≥n a "${programaNombre}"?`,
            ''
          );
          
          // Si el usuario cancela el prompt, salir
          if (observacion === null) {
            console.log('Usuario cancel√≥ el prompt de observaci√≥n');
            return;
          }
          
          console.log('Observaci√≥n del usuario:', observacion);

          // Confirmar la inscripci√≥n
          const confirmarInscripcion = await showConfirmModal(
            'Confirmar Inscripci√≥n',
            `¬øConfirmas tu inscripci√≥n en "${programaNombre}"?`
          );
          
          if (!confirmarInscripcion) {
            console.log('Usuario cancel√≥ la inscripci√≥n');
            return;
          }

          // Preparar el body de la petici√≥n
          const bodyData = {
            observacion: observacion || '',
            programa: programaId // Solo el UUID del programa
          };
          console.log('Body de la petici√≥n:', bodyData);

          // Deshabilitar el bot√≥n mientras se procesa
          button.disabled = true;
          button.innerHTML = `
            <span class="flex items-center justify-center gap-2">
              Procesando...
              <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </span>
          `;

          try {
            const API_BASE = import.meta.env.PUBLIC_API_BASE;
            console.log('Enviando petici√≥n a:', `${API_BASE}/inscripcion`);
            
            const response = await fetch(`${API_BASE}/inscripcion`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
              },
              body: JSON.stringify(bodyData)
            });

            console.log('Respuesta recibida - Status:', response.status);

            if (response.ok) {
              // Intentar parsear como JSON, si falla obtener como texto
              let data;
              let mensaje = '';
              
              try {
                const responseText = await response.text();
                console.log('Respuesta como texto:', responseText);
                
                // Intentar parsear como JSON
                try {
                  data = JSON.parse(responseText);
                  console.log('Respuesta parseada como JSON:', data);
                  
                  // Verificar si es una respuesta exitosa con inscripci√≥n
                  if (data.message && data.inscripcion) {
                    mensaje = `${data.message} Te has inscrito en "${programaNombre}".`;
                  } else {
                    mensaje = data.message || `¬°Inscripci√≥n exitosa! Te has inscrito en "${programaNombre}".`;
                  }
                } catch {
                  // Si no es JSON, usar el texto directamente
                  console.log('La respuesta no es JSON, usando texto plano');
                  mensaje = responseText || `¬°Inscripci√≥n exitosa! Te has inscrito en "${programaNombre}".`;
                }
              } catch (error) {
                console.error('Error al leer la respuesta:', error);
                mensaje = `¬°Inscripci√≥n exitosa! Te has inscrito en "${programaNombre}".`;
              }
              
              await showSuccessModal('¬°Inscripci√≥n Exitosa!', `${mensaje} Pronto nos pondremos en contacto contigo.`);
              
              // Cambiar el bot√≥n para indicar que ya est√° inscrito
              button.innerHTML = `
                <span class="flex items-center justify-center gap-2">
                  ‚úì Ya inscrito
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                </span>
              `;
              button.disabled = true;
              button.classList.remove('hover:from-blue-700', 'hover:to-purple-700', 'hover:scale-105');
              button.classList.add('opacity-60', 'cursor-not-allowed');
            } else {
              // Manejar errores espec√≠ficos
              let errorTitle = 'Error en la Inscripci√≥n';
              let errorMessage = 'Error al procesar la inscripci√≥n';
              
              try {
                const errorData = await response.json();
                console.error('Error en la respuesta:', errorData);
                
                // Manejar caso espec√≠fico de inscripci√≥n duplicada (409)
                if (response.status === 409) {
                  errorTitle = 'Inscripci√≥n Ya Existente';
                  errorMessage = errorData.message || 'Ya existe una inscripci√≥n para este usuario en este programa';
                } else {
                  errorMessage = errorData.message || errorData.error || 'Error al procesar la inscripci√≥n';
                }
              } catch (parseError) {
                console.error('Error al parsear respuesta de error:', parseError);
                errorMessage = `Error ${response.status}: ${response.statusText}`;
              }
              
              await showErrorModal(errorTitle, errorMessage);
              
              // Restaurar el bot√≥n
              button.disabled = false;
              button.innerHTML = `
                <span class="flex items-center justify-center gap-2">
                  Inscribirme ahora
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                  </svg>
                </span>
              `;
            }
          } catch (error) {
            console.error('=== ERROR AL PROCESAR INSCRIPCI√ìN ===');
            console.error('Detalles del error:', error);
            await showErrorModal('Error de Conexi√≥n', 'Error de conexi√≥n. Por favor, intenta nuevamente.');
            
            // Restaurar el bot√≥n
            button.disabled = false;
            button.innerHTML = `
              <span class="flex items-center justify-center gap-2">
                Inscribirme ahora
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                </svg>
              </span>
            `;
          }
          console.log('=== FIN DE INSCRIPCI√ìN ===\n');
        });
      });
    }

    // Cargar programas al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('=== CARGANDO P√ÅGINA DE PROGRAMAS ===');
      try {
        console.log('Intentando obtener programas desde la API...');
        // Intentar obtener programas desde la API
        const programas = await getProgramas();
        console.log('Programas obtenidos:', programas);
        if (programas && programas.length > 0) {
          console.log(`Renderizando ${programas.length} programas desde la API`);
          renderProgramas(programas);
        } else {
          console.log('No se obtuvieron programas desde la API, usando fallback');
          // Si no hay programas, los event listeners ya est√°n en el HTML renderizado por Astro
          attachEventListeners();
        }
      } catch (error) {
        console.error('=== ERROR AL CARGAR PROGRAMAS ===');
        console.error('Detalles del error:', error);
        console.log('Usando programas de fallback');
        // En caso de error, los programas de fallback ya est√°n renderizados
        // Solo necesitamos agregar los event listeners
        attachEventListeners();
      }
      console.log('=== P√ÅGINA DE PROGRAMAS CARGADA ===\n');
    });
  </script>
</Layout>
